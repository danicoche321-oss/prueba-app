<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Antigravity Fitness</title>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/lucide-react@latest"></script>

    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Firebase SDKs (Compat for simple HTML usage) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <style>
        body {
            -webkit-tap-highlight-color: transparent;
            overscroll-behavior-y: none;
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }

        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
    </style>

    <!-- Theme Config (Inlined) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            DEFAULT: '#E63946',
                            50: '#FDECEC',
                            100: '#FBD9DA',
                            200: '#F7B4B6',
                            300: '#F38E92',
                            400: '#EF696E',
                            500: '#E63946',
                            600: '#CF1D2A',
                            700: '#A61722',
                            800: '#7D1119',
                            900: '#530B11'
                        },
                        secondary: '#1D3557',
                        background: '#F1FAEE',
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
</head>

<body class="bg-gray-50 text-slate-900 select-none">
    <div id="root"></div>

    <!-- FIREBASE CONFIGURATION -->
    <script>
        // ⚠️ IMPORTANTE: SUSTITUYE ESTO CON TU CONFIGURACIÓN DE FIREBASE ⚠️
        // 1. Ve a https://console.firebase.google.com/
        // 2. Crea un proyecto (o usa uno existente)
        // 3. Ve a Configuración del Proyecto (rueda dentada) -> General -> "Tus apps" -> </> (Web)
        // 4. Copia el objeto 'firebaseConfig' y pégalo aquí abajo:
        const firebaseConfig = {
            apiKey: "AIzaSyAbZ0qx3Mcw4HzfZN1a-EoAaz4LhViHT6c",
            authDomain: "prueba-app-fitness.firebaseapp.com",
            projectId: "prueba-app-fitness",
            storageBucket: "prueba-app-fitness.firebasestorage.app",
            messagingSenderId: "320494827262",
            appId: "1:320494827262:web:fde9f20d6a87d63f0317af",
            measurementId: "G-KXSJ1FKW5L"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
            console.log("Firebase initialized");
        } catch (e) {
            console.error("Error initializing Firebase (Did you paste your config?):", e);
        }
    </script>

    <!-- Main Application (Inlined) -->
    <script type="text/babel">
        // --- COMPONENTS ---

        const CalorieTracker = () => {
            const [calories, setCalories] = React.useState(1250);
            const target = 2200;
            const percentage = Math.min((calories / target) * 100, 100);

            return (
                <div className="bg-white rounded-2xl p-6 shadow-sm border border-pink-100 mb-6 relative overflow-hidden">
                    <div className="flex justify-between items-center z-10 relative">
                        <div>
                            <h2 className="text-lg font-bold text-gray-800">Resumen Diario</h2>
                            <p className="text-sm text-gray-500">Hoy, {new Date().toLocaleDateString('es-ES', { weekday: 'long', day: 'numeric' })}</p>
                        </div>
                        <div className="text-right">
                            <span className="text-3xl font-extrabold text-primary-600">{calories}</span>
                            <span className="text-xs text-gray-400 block">/ {target} kcal</span>
                        </div>
                    </div>
                    <div className="mt-6">
                        <div className="h-4 w-full bg-gray-100 rounded-full overflow-hidden">
                            <div className="h-full bg-gradient-to-r from-primary-400 to-primary-600 rounded-full transition-all duration-1000 ease-out" style={{ width: `${percentage}%` }}></div>
                        </div>
                    </div>
                </div>
            );
        };

        const ProgressChart = ({ routineName, dataPoints }) => {
            const chartRef = React.useRef(null);
            const chartInstanceRef = React.useRef(null);

            React.useEffect(() => {
                const ctx = chartRef.current.getContext('2d');
                if (chartInstanceRef.current) chartInstanceRef.current.destroy();

                const gradient = ctx.createLinearGradient(0, 0, 0, 200);
                gradient.addColorStop(0, 'rgba(230, 57, 70, 0.5)');
                gradient.addColorStop(1, 'rgba(230, 57, 70, 0.0)');

                chartInstanceRef.current = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'],
                        datasets: [{
                            data: dataPoints,
                            borderColor: '#E63946',
                            backgroundColor: gradient,
                            borderWidth: 3,
                            pointBackgroundColor: '#fff',
                            pointBorderColor: '#E63946',
                            pointBorderWidth: 2,
                            fill: true,
                            tension: 0.4
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: { y: { display: false }, x: { grid: { display: false }, ticks: { font: { size: 10 }, color: '#9CA3AF' } } }
                    }
                });
                return () => { if (chartInstanceRef.current) chartInstanceRef.current.destroy(); }
            }, [dataPoints]);

            return (
                <div className="bg-white rounded-2xl p-6 shadow-sm border border-gray-100 mb-6">
                    <div className="mb-4">
                        <h3 className="font-bold text-gray-800 text-lg">Evolución: {routineName}</h3>
                        <p className="text-xs text-gray-400">Volumen de carga (último mes)</p>
                    </div>
                    <div className="h-40">
                        <canvas ref={chartRef}></canvas>
                    </div>
                </div>
            );
        };

        const ExerciseCard = ({ exercise, onUpdateSet, onAddSet, onRemoveSet }) => {
            const [isOpen, setIsOpen] = React.useState(false);

            // Calculate active volume (just for fun/display)
            const totalSets = exercise.sets.length;
            const maxWeight = Math.max(...exercise.sets.map(s => parseInt(s.weight) || 0));

            return (
                <div className="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden transition-all duration-300">
                    {/* Header */}
                    <div onClick={() => setIsOpen(!isOpen)} className="p-4 flex gap-4 items-center cursor-pointer hover:bg-gray-50/50">
                        <div className="w-16 h-16 bg-primary-50 rounded-xl flex items-center justify-center overflow-hidden shrink-0">
                            <img src={exercise.img} alt={exercise.name} className="w-full h-full object-cover mix-blend-multiply" />
                        </div>
                        <div className="flex-1">
                            <h4 className="font-bold text-gray-900 mb-1">{exercise.name}</h4>
                            <p className="text-xs text-gray-500">{exercise.muscle} • {totalSets} Series</p>
                        </div>
                        <div className={`transform transition-transform duration-300 ${isOpen ? 'rotate-180' : ''}`}>
                            <i data-lucide="chevron-down" className="w-5 h-5 text-gray-300"></i>
                        </div>
                    </div>

                    {/* Sets Table */}
                    <div className={`bg-gray-50/50 border-t border-gray-100 transition-all duration-300 ease-in-out ${isOpen ? 'max-h-[500px] opacity-100' : 'max-h-0 opacity-0 overflow-hidden'}`}>
                        <div className="p-4">
                            <div className="grid grid-cols-10 gap-2 mb-2 text-[10px] items-center text-gray-400 font-bold uppercase tracking-wider text-center">
                                <span className="col-span-2">Serie</span>
                                <span className="col-span-3">Kg</span>
                                <span className="col-span-3">Reps</span>
                                <span className="col-span-2">Listo</span>
                            </div>

                            <div className="space-y-2">
                                {exercise.sets.map((set, index) => (
                                    <div key={set.id} className={`grid grid-cols-10 gap-2 items-center ${set.isCompleted ? 'opacity-50' : ''}`}>
                                        <div className="col-span-2 flex justify-center">
                                            <div className="w-6 h-6 rounded-full bg-gray-200 text-gray-600 flex items-center justify-center text-xs font-bold">
                                                {index + 1}
                                            </div>
                                        </div>
                                        <div className="col-span-3">
                                            <input
                                                type="number"
                                                value={set.weight}
                                                onChange={(e) => onUpdateSet(exercise.id, set.id, 'weight', e.target.value)}
                                                className="w-full text-center bg-white border border-gray-200 rounded-lg py-1 text-sm font-bold text-gray-700 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 outline-none transition-all"
                                            />
                                        </div>
                                        <div className="col-span-3">
                                            <input
                                                type="number"
                                                value={set.reps}
                                                onChange={(e) => onUpdateSet(exercise.id, set.id, 'reps', e.target.value)}
                                                className="w-full text-center bg-white border border-gray-200 rounded-lg py-1 text-sm font-bold text-gray-700 focus:border-primary-500 focus:ring-1 focus:ring-primary-500 outline-none transition-all"
                                            />
                                        </div>
                                        <div className="col-span-2 flex justify-center">
                                            <button
                                                onClick={() => onUpdateSet(exercise.id, set.id, 'isCompleted', !set.isCompleted)}
                                                className={`w-8 h-8 rounded-lg flex items-center justify-center transition-colors ${set.isCompleted ? 'bg-green-500 text-white shadow-lg shadow-green-200' : 'bg-gray-200 text-gray-400 hover:bg-gray-300'}`}
                                            >
                                                <i data-lucide="check" className="w-4 h-4"></i>
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="mt-4 flex gap-3">
                                <button
                                    onClick={() => onAddSet(exercise.id)}
                                    className="flex-1 py-2 bg-primary-50 text-primary-600 rounded-lg text-xs font-bold hover:bg-primary-100 transition-colors flex items-center justify-center gap-2"
                                >
                                    <i data-lucide="plus" className="w-3 h-3"></i> Añadir Serie
                                </button>
                                {exercise.sets.length > 0 && (
                                    <button
                                        onClick={() => onRemoveSet(exercise.id)}
                                        className="w-10 flex items-center justify-center py-2 bg-white border border-gray-200 text-gray-400 rounded-lg text-xs font-bold hover:bg-red-50 hover:text-red-500 hover:border-red-100 transition-colors"
                                    >
                                        <i data-lucide="trash-2" className="w-4 h-4"></i>
                                    </button>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- AUTH COMPONENTS ---

        const Login = ({ onLogin }) => {
            const [email, setEmail] = React.useState('');
            const [password, setPassword] = React.useState('');
            const [error, setError] = React.useState('');
            const [loading, setLoading] = React.useState(false);

            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setLoading(true);

                try {
                    await firebase.auth().signInWithEmailAndPassword(email, password);
                    // Auth state listener in App will handle the rest
                } catch (err) {
                    console.error(err);
                    setError('Error: Email o contraseña incorrectos.');
                    setLoading(false);
                }
            };

            return (
                <div className="min-h-screen flex items-center justify-center p-6 bg-white">
                    <div className="w-full max-w-sm space-y-8 animate-fade-in">
                        <div className="text-center">
                            <h1 className="text-3xl font-black text-gray-900 tracking-tight mb-2">
                                Antigravity<span className="text-primary-500">.</span>
                            </h1>
                            <p className="text-gray-500">Inicia sesión para entrenar</p>
                        </div>

                        {error && (
                            <div className="bg-red-50 text-red-500 p-4 rounded-xl text-sm font-medium border border-red-100 flex items-center gap-2">
                                <i data-lucide="alert-circle" className="w-4 h-4"></i>
                                {error}
                            </div>
                        )}
                        {/* Warning about Config */}
                        {firebaseConfig.apiKey === "API_KEY_AQUI" && (
                            <div className="bg-yellow-50 text-yellow-700 p-4 rounded-xl text-xs border border-yellow-200">
                                <strong>⚠️ Configuración Faltante:</strong><br />
                                Abre el archivo <code>index.html</code> y pega tu configuración de Firebase en la línea 78.
                            </div>
                        )}

                        <form onSubmit={handleSubmit} className="space-y-4">
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">Email</label>
                                <input
                                    type="email"
                                    required
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    placeholder="usuario@ejemplo.com"
                                    className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all font-medium"
                                />
                            </div>
                            <div>
                                <label className="block text-sm font-bold text-gray-700 mb-1">Contraseña</label>
                                <input
                                    type="password"
                                    required
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    placeholder="••••••••"
                                    className="w-full px-4 py-3 rounded-xl bg-gray-50 border border-gray-100 focus:outline-none focus:ring-2 focus:ring-primary-500/20 focus:border-primary-500 transition-all font-medium"
                                />
                            </div>
                            <button
                                type="submit"
                                disabled={loading}
                                className="w-full bg-primary-600 text-white rounded-xl py-4 font-bold text-lg shadow-lg shadow-primary-500/30 hover:bg-primary-700 hover:shadow-primary-500/40 active:scale-[0.98] transition-all flex items-center justify-center gap-2"
                            >
                                {loading ? <i data-lucide="loader-2" className="w-5 h-5 animate-spin"></i> : 'Entrar'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        const RoutineSelector = ({ activeRoutine, setActiveRoutine }) => {
            const routines = [
                { id: 'push', name: 'Pecho / Tríceps' },
                { id: 'pull', name: 'Espalda / Bíceps' },
                { id: 'legs', name: 'Pierna' }
            ];

            return (
                <div className="flex gap-2 overflow-x-auto no-scrollbar mb-6 pb-2">
                    {routines.map(routine => (
                        <button
                            key={routine.id}
                            onClick={() => setActiveRoutine(routine.id)}
                            className={`flex-shrink-0 px-5 py-2.5 rounded-full text-sm font-bold transition-all duration-300 ${activeRoutine === routine.id
                                ? 'bg-primary-600 text-white shadow-lg shadow-primary-200 transform scale-105'
                                : 'bg-white text-gray-500 border border-gray-100 hover:bg-gray-50'
                                }`}
                        >
                            {routine.name}
                        </button>
                    ))}
                </div>
            );
        };

        // --- MAIN APP (Authenticated) ---

        const Dashboard = ({ user, onLogout }) => {
            const [activeTab, setActiveTab] = React.useState('home');
            const [activeRoutine, setActiveRoutine] = React.useState('push');

            // --- DATA STORE ---
            // Helper to generate default sets
            const createSets = (count, weight, reps) =>
                Array.from({ length: count }, (_, i) => ({ id: Date.now() + i, weight, reps, isCompleted: false }));

            const [routinesData, setRoutinesData] = React.useState({
                push: {
                    name: "Pecho / Tríceps",
                    stats: [7500, 7800, 8100, 8500],
                    exercises: [
                        { id: 'p1', name: 'Press de Banca', muscle: 'Pecho', img: './assets/bench_press.png', sets: createSets(4, 60, 10) },
                        { id: 'p2', name: 'Elevaciones Lat.', muscle: 'Hombro', img: './assets/shoulder_press.png', sets: createSets(3, 10, 15) },
                        { id: 'p3', name: 'Press Militar', muscle: 'Hombro', img: './assets/shoulder_press.png', sets: createSets(4, 20, 10) },
                    ]
                },
                pull: {
                    name: "Espalda / Bíceps",
                    stats: [6200, 6800, 6500, 7200],
                    exercises: [
                        { id: 'b1', name: 'Peso Muerto', muscle: 'Espalda', img: './assets/deadlift.png', sets: createSets(3, 100, 5) },
                        { id: 'b2', name: 'Curl de Bíceps', muscle: 'Bíceps', img: './assets/bench_press.png', sets: createSets(3, 15, 12) },
                    ]
                },
                legs: {
                    name: "Pierna Completa",
                    stats: [8000, 8200, 9000, 9500],
                    exercises: [
                        { id: 'l1', name: 'Sentadilla', muscle: 'Cuádriceps', img: './assets/squat.png', sets: createSets(4, 80, 10) },
                        { id: 'l2', name: 'Prensa', muscle: 'Piernas', img: './assets/squat.png', sets: createSets(3, 120, 12) },
                    ]
                }
            });

            // Handlers
            const handleUpdateSet = (exerciseId, setId, field, value) => {
                setRoutinesData(prev => {
                    const currentRoutine = prev[activeRoutine];
                    const updatedExercises = currentRoutine.exercises.map(ex => {
                        if (ex.id !== exerciseId) return ex;
                        const updatedSets = ex.sets.map(s => s.id === setId ? { ...s, [field]: value } : s);
                        return { ...ex, sets: updatedSets };
                    });
                    return { ...prev, [activeRoutine]: { ...currentRoutine, exercises: updatedExercises } };
                });
            };

            const handleAddSet = (exerciseId) => {
                setRoutinesData(prev => {
                    const currentRoutine = prev[activeRoutine];
                    const updatedExercises = currentRoutine.exercises.map(ex => {
                        if (ex.id !== exerciseId) return ex;
                        // Clone last set or default
                        const lastSet = ex.sets[ex.sets.length - 1] || { weight: 0, reps: 0 };
                        const newSet = { id: Date.now(), weight: lastSet.weight, reps: lastSet.reps, isCompleted: false };
                        return { ...ex, sets: [...ex.sets, newSet] };
                    });
                    return { ...prev, [activeRoutine]: { ...currentRoutine, exercises: updatedExercises } };
                });
            };

            const handleRemoveSet = (exerciseId) => {
                setRoutinesData(prev => {
                    const currentRoutine = prev[activeRoutine];
                    const updatedExercises = currentRoutine.exercises.map(ex => {
                        if (ex.id !== exerciseId) return ex;
                        const newSets = ex.sets.slice(0, -1); // Remove last
                        return { ...ex, sets: newSets };
                    });
                    return { ...prev, [activeRoutine]: { ...currentRoutine, exercises: updatedExercises } };
                });
            };

            // Initialize Icons
            React.useEffect(() => {
                if (window.lucide) window.lucide.createIcons();
            }, [activeTab, activeRoutine, routinesData]);

            const currentData = routinesData[activeRoutine];

            return (
                <div className="min-h-screen pb-24 bg-gray-50 font-sans">
                    {/* Header */}
                    <div className="bg-white p-6 pb-4 sticky top-0 z-50 border-b border-gray-100/50 backdrop-blur-md bg-white/80">
                        <div className="flex justify-between items-center">
                            <div>
                                <h1 className="text-2xl font-black text-gray-900 tracking-tight">Antigravity<span className="text-primary-500">.</span></h1>
                                <p className="text-xs text-gray-500 font-medium">Hola, {user.email.split('@')[0]}</p>
                            </div>
                            <div onClick={onLogout} className="w-10 h-10 rounded-full bg-gray-200 overflow-hidden border-2 border-white shadow-sm cursor-pointer hover:ring-2 hover:ring-primary-100 transition-all">
                                <img src={`https://api.dicebear.com/7.x/avataaars/svg?seed=${user.email}`} alt="User" />
                            </div>
                        </div>
                    </div>

                    {/* Content */}
                    <div className="p-6 space-y-2 animate-fade-in">
                        {activeTab === 'home' && (
                            <React.Fragment>
                                <CalorieTracker />
                                <RoutineSelector activeRoutine={activeRoutine} setActiveRoutine={setActiveRoutine} />
                                <ProgressChart routineName={currentData.name} dataPoints={currentData.stats} />

                                <div className="mt-8">
                                    <div className="flex justify-between items-end mb-4">
                                        <h3 className="font-bold text-gray-800 text-lg">Rutina Actual</h3>
                                        <span className="text-xs text-gray-400 font-medium">Editar Series</span>
                                    </div>
                                    <div className="space-y-4">
                                        {currentData.exercises.map(ex => (
                                            <ExerciseCard
                                                key={ex.id}
                                                exercise={ex}
                                                onUpdateSet={handleUpdateSet}
                                                onAddSet={handleAddSet}
                                                onRemoveSet={handleRemoveSet}
                                            />
                                        ))}
                                    </div>
                                </div>
                            </React.Fragment>
                        )}
                        {/* Fake placeholders */}
                        {activeTab !== 'home' && (
                            <div className="text-center py-20 text-gray-400 opacity-50">
                                <i data-lucide="construction" className="w-12 h-12 mx-auto mb-4"></i>
                                <p>En construcción</p>
                            </div>
                        )}
                    </div>

                    {/* Bottom Navigation */}
                    <div className="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-100 flex justify-around items-center p-4 pb-8 z-50 shadow-[0_-5px_20px_rgba(0,0,0,0.03)]">
                        <button onClick={() => setActiveTab('home')} className={`flex flex-col items-center gap-1 transition-colors ${activeTab === 'home' ? 'text-primary-500' : 'text-gray-400'}`}>
                            <i data-lucide="home" className={`w-6 h-6 ${activeTab === 'home' ? 'stroke-[2.5px]' : ''}`}></i>
                        </button>
                        <div className="relative -top-8">
                            <button className="w-14 h-14 bg-primary-500 rounded-full text-white shadow-lg flex items-center justify-center transform active:scale-95">
                                <i data-lucide="plus" className="w-7 h-7 stroke-[3px]"></i>
                            </button>
                        </div>
                        <button onClick={() => setActiveTab('calendar')} className={`flex flex-col items-center gap-1 transition-colors ${activeTab === 'calendar' ? 'text-primary-500' : 'text-gray-400'}`}>
                            <i data-lucide="calendar-days" className={`w-6 h-6 ${activeTab === 'calendar' ? 'stroke-[2.5px]' : ''}`}></i>
                        </button>
                    </div>
                </div>
            );
        };

        // --- ROOT COMPONENT (Auth Handler) ---

        const App = () => {
            const [user, setUser] = React.useState(null);
            const [loading, setLoading] = React.useState(true);

            React.useEffect(() => {
                // Listen to Firebase Auth state
                const unsubscribe = firebase.auth().onAuthStateChanged((u) => {
                    setUser(u);
                    setLoading(false);
                });
                return () => unsubscribe();
            }, []);

            const handleLogout = () => {
                firebase.auth().signOut();
            };

            if (loading) {
                return (
                    <div className="min-h-screen flex items-center justify-center bg-white">
                        <i data-lucide="loader-2" className="w-8 h-8 text-primary-500 animate-spin"></i>
                    </div>
                );
            }

            if (!user) {
                return <Login />;
            }

            return <Dashboard user={user} onLogout={handleLogout} />;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>

</html>